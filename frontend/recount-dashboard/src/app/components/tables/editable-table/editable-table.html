<div class="bg-white rounded-lg shadow-sm overflow-hidden">
  <!-- Table Header -->

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <span class="ml-3 text-gray-600">Loading...</span>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto" *ngIf="!loading">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th *ngFor="let column of columns"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            {{ column.label }}
          </th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
              *ngIf="canEdit || canDelete">
            Acciones
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr *ngFor="let item of data; let i = index; trackBy: trackByFn"
            [class.bg-yellow-50]="isEditing(i)">

          <!-- Data Columns -->
          <td *ngFor="let column of columns"
              class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            <!-- View Mode -->
            <span *ngIf="!isEditing(i)" 
                  [class.clickable-cell]="column.key === 'name'"
                  (click)="column.key === 'name' ? onCellClick(item, column, i) : null">
              {{ column.formatter ? column.formatter(getColumnValue(item, column), item) : formatValue(getColumnValue(item, column), column) }}
            </span>

            <!-- Edit Mode -->
            <div *ngIf="isEditing(i) && column.editable !== false">
              <!-- Text Input -->
              <input *ngIf="column.type === 'text' || column.type === 'number'"
                     [type]="column.type"
                     [value]="getColumnValue(editedItem, column)"
                     (input)="setColumnValue($any($event.target).value, column)"
                     class="w-full px-2 py-1 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                     [required]="column.required">

              <!-- Currency Input -->
              <input *ngIf="column.type === 'currency'"
                     type="number"
                     step="0.01"
                     [value]="getColumnValue(editedItem, column)"
                     (input)="setColumnValue($any($event.target).value, column)"
                     class="w-full px-2 py-1 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                     [required]="column.required">

              <!-- Date Input -->
              <input *ngIf="column.type === 'date'"
                     type="date"
                     [value]="getColumnValue(editedItem, column) | date:'yyyy-MM-dd'"
                     (input)="setColumnValue($any($event.target).value, column)"
                     class="w-full px-2 py-1 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                     [required]="column.required">

              <!-- Select Dropdown -->
              <select *ngIf="column.type === 'select' && column.options"
                      [value]="getColumnValue(editedItem, column)"
                      (change)="setColumnValue($any($event.target).value, column)"
                      class="w-full px-2 py-1 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                      [required]="column.required">
                <option *ngFor="let option of column.options" [value]="option.value">
                  {{ option.label }}
                </option>
              </select>

              <!-- Boolean Checkbox -->
              <input *ngIf="column.type === 'boolean'"
                     type="checkbox"
                     [checked]="getColumnValue(editedItem, column)"
                     (change)="setColumnValue($any($event.target).checked, column)"
                     class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
            </div>
          </td>

          <!-- Actions Column -->
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium" *ngIf="canEdit || canDelete">
            <div class="flex justify-end space-x-2">
              <!-- Edit/Save/Cancel Buttons -->
              <button *ngIf="canEdit && !isEditing(i)"
                      (click)="startEdit(item, i)"
                      class="text-blue-600 hover:text-blue-900 p-1">
                <i class="fas fa-edit"></i>
              </button>

              <button *ngIf="isEditing(i)"
                      (click)="saveEdit()"
                      class="text-green-600 hover:text-green-900 p-1">
                <i class="fas fa-check"></i>
              </button>

              <button *ngIf="isEditing(i)"
                      (click)="cancelEdit()"
                      class="text-gray-600 hover:text-gray-900 p-1">
                <i class="fas fa-times"></i>
              </button>

              <!-- Delete Button -->
              <button *ngIf="canDelete && !isEditing(i)"
                      (click)="confirmDelete(item, i)"
                      class="text-red-600 hover:text-red-900 p-1">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>

        <!-- Empty State -->
        <tr *ngIf="data.length === 0">
          <td [attr.colspan]="columns.length + (canEdit || canDelete ? 1 : 0)"
              class="px-6 py-12 text-center text-gray-500">
            <i class="fas fa-inbox text-4xl mb-4 text-gray-300"></i>
            <p>No data available</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
