<!-- Account Detail Page -->
<div page-content>

  <!-- Header -->
  <div class="account-header">
    <button class="btn" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Volver
    </button>
    <h2 *ngIf="account">{{ account.name }}</h2>
    <h2 *ngIf="!account">Detalles de la Cuenta</h2>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <span class="loading"></span>
    <p>Cargando información...</p>
  </div>

  <!-- Account Information -->
  <div *ngIf="!loading && account">

    <!-- Account Summary Card -->
    <div class="card">
      <div class="card-header">
        <h3>Resumen de la Cuenta</h3>
      </div>
      <div class="card-body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); margin-bottom: var(--space-4);">

          <!-- Left Column: Balances -->
          <div>
            <div class="balance-header">
              <label class="form-label">Balances</label>

              <!-- Currency selector -->
              <div *ngIf="!loadingRates && exchangeRates.length > 0" class="currency-selector">
                <select [(ngModel)]="preferredCurrency" (change)="onPreferredCurrencyChange()" class="form-control">
                  <option *ngFor="let currency of currencies" [value]="currency">
                  {{ currency }}
                  </option>
                </select>
              </div>
            </div>

            <div *ngIf="getAccountBalances().length > 0" class="balance-list">
              <!-- With exchange rates -->
              <ng-container *ngIf="exchangeRates.length > 0">
                <div *ngFor="let balance of getBalancesWithConversion()" class="balance-item">
                  <span class="currency-label">{{ balance.currency }}:</span>
                  <span class="amount-value" [class]="balance.amount > 0 ? 'positive' : balance.amount < 0 ? 'negative' : ''">
                    {{ balance.amount | number:'1.2-2' }}
                  </span>
                  <span *ngIf="balance.currency !== preferredCurrency && balance.convertedAmount !== undefined" class="converted-text">
                    (≈ {{ balance.convertedAmount | number:'1.2-2' }} {{ preferredCurrency }})
                  </span>
                </div>
              </ng-container>

              <!-- Without exchange rates -->
              <ng-container *ngIf="exchangeRates.length === 0">
                <div *ngFor="let balance of getAccountBalances(); trackBy: trackByBalance" class="balance-item">
                  <span class="currency-label">{{ balance.currency }}:</span>
                  <span class="amount-value" [class]="balance.amount > 0 ? 'positive' : balance.amount < 0 ? 'negative' : ''">
                    {{ balance.amount | number:'1.2-2' }}
                  </span>
                </div>
              </ng-container>
            </div>

            <div *ngIf="getAccountBalances().length === 0" class="text-muted" style="padding: var(--space-2); text-align: center; font-style: italic;">
              Sin balances
            </div>
          </div>

          <!-- Right Column: Summary -->
          <div>

            <!-- Total Balance Card -->
            <div style="margin-bottom: var(--space-4);">
              <label class="form-label">Balance Total</label>
              <div class="total-amount" [class]="getTotalBalance() > 0 ? 'positive' : getTotalBalance() < 0 ? 'negative' : ''">
                {{ getTotalBalance() | number:'1.2-2' }}
              </div>

              <div *ngIf="!loadingRates && exchangeRates.length > 0" class="converted-summary">
                <span class="converted-label">En {{ preferredCurrency }}:</span>
                <span class="converted-amount" [class]="getTotalBalanceConverted() > 0 ? 'positive' : getTotalBalanceConverted() < 0 ? 'negative' : ''">
                  {{ getTotalBalanceConverted() | number:'1.2-2' }}
                </span>
              </div>
            </div>

            <!-- Account Info -->
            <div>
              <label class="form-label">Información</label>
              <div class="info-grid">
                <div class="info-row">
                  <span class="info-label">Creada:</span>
                  <span class="info-value">{{ formatDate(account.createdAt) }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Actualizada:</span>
                  <span class="info-value">{{ formatDate(account.updatedAt) }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Transacciones:</span>
                  <span class="info-value">{{ transactions.length }}</span>
                </div>
              </div>
            </div>

          </div>

        </div>
      </div>
    </div>

    <!-- Transactions History -->
    <div class="card">
      <div class="card-header">
        <h3>Historial de Transacciones</h3>
      </div>
      <div class="card-body">

        <!-- Empty State -->
        <div *ngIf="transactions.length === 0" class="empty-state">
          <i class="fas fa-inbox"></i>
          <p>No hay transacciones para esta cuenta</p>
        </div>

        <!-- Transactions Table -->
        <div *ngIf="transactions.length > 0" class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Tipo</th>
                <th>Descripción</th>
                <th>Moneda</th>
                <th class="text-right">Monto</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let transaction of transactions">
                <td>{{ formatDate(transaction.createdAt) }}</td>
                <td>
                  <span class="transaction-type" [class]="getTransactionTypeClass(transaction.type)">
                    {{ getTransactionSignAndType(transaction).type }}
                  </span>
                </td>
                <td>{{ getTransactionDescription(transaction) }}</td>
                <td>{{ transaction.currency }}</td>
                <td class="text-right">
                  <span class="amount" [class]="getTransactionTypeClass(transaction.type)">
                    {{ getTransactionSignAndType(transaction).sign }}{{ transaction.amount | number:'1.2-2' }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>

  </div>

</div>
