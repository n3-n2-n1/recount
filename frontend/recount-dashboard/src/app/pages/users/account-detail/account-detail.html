<!-- Account Detail Page -->
<div page-content>

  <!-- Toast Notifications -->
  <div class="toast-container">
    <div *ngFor="let toast of toasts"
         [class]="'toast toast-' + toast.type + ' ' + (toast.show ? 'toast-show' : '')">
      <div class="toast-icon">
        <i [class]="toast.type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
      </div>
      <div class="toast-content">
        <div class="toast-message">{{ toast.message }}</div>
      </div>
      <button class="toast-close" (click)="removeToast(toast.id)">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- Header -->
  <div class="account-header">
    <button class="btn" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Volver
    </button>
    <h2 *ngIf="account">{{ account.name }}</h2>
    <h2 *ngIf="!account">Detalles de la Cuenta</h2>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center" style="padding: var(--space-4);">
    <span class="loading"></span> Cargando información...
  </div>

  <!-- Account Information -->
  <div *ngIf="!loading && account">

        <!-- Summary Cards -->
        <div class="summary-cards-grid" style="margin-top: var(--space-3);">
    
          <div class="summary-card">
            <div class="summary-card-body">
              <div class="flex-between">
                <span>Transacciones</span>
                <strong>{{ transactions.length }}</strong>
              </div>
            </div>
          </div>
    
          <div class="summary-card">
            <div class="summary-card-body">
              <div class="flex-between">
                <span>Monedas Activas</span>
                <strong>{{ getAccountBalances().length }}</strong>
              </div>
            </div>
          </div>
    
          <div class="summary-card">
            <div class="summary-card-body">
              <div class="flex-between">
                <span>Última Actividad</span>
                <strong>{{ transactions.length > 0 ? formatDate(transactions[0].createdAt) : 'Nunca' }}</strong>
              </div>
            </div>
          </div>
        </div>
    

    <!-- Currency Cards -->
    <div class="currency-cards-grid">
      <div *ngFor="let currency of mainCurrencies" class="currency-card">
        <div class="currency-card-header">
          <div class="currency-icon" [class]="getCurrencyColor(currency)">
            <i [class]="getCurrencyIcon(currency)"></i>
          </div>
          <h3 class="currency-title">{{ currency }}</h3>
        </div>

        <div class="currency-balance">
          <div class="balance-amount" [class]="getBalanceForCurrency(currency) >= 0 ? 'positive' : 'negative'">
            {{ formatCurrencyLatin(getBalanceForCurrency(currency)) }}
          </div>
          <!-- Fee information -->
          <div class="fee-info" *ngIf="getFeeForTransaction(currency, 'Entrada') || getFeeForTransaction(currency, 'Salida')">
            <div class="fee-item" *ngIf="getFeeForTransaction(currency, 'Entrada') as fee">
              <small class="fee-text">Ingreso: {{ fee.percentage }}% fee</small>
            </div>
            <div class="fee-item" *ngIf="getFeeForTransaction(currency, 'Salida') as fee">
              <small class="fee-text">Egreso: {{ fee.percentage }}% fee</small>
            </div>
          </div>
        </div>

        <div class="currency-actions" *ngIf="authService.canEdit()">
          <button class="btn btn-success btn-sm action-btn" (click)="openTransactionModal(currency, 'Entrada')" title="Nuevo Ingreso">
            <i class="fas fa-plus"></i>
          </button>
          <button class="btn btn-error btn-sm action-btn" (click)="openTransactionModal(currency, 'Salida')" title="Nuevo Egreso">
            <i class="fas fa-minus"></i>
          </button>
          <button class="btn btn-warning btn-sm action-btn" (click)="openSwapModal(currency)" title="Intercambiar">
            <i class="fas fa-exchange-alt"></i>
          </button>
          <button class="btn btn-info btn-sm action-btn" (click)="openTransferModal(currency)" title="Transferir">
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Transactions History -->
    <div class="card">
      <div class="card-header">
        <h3>Historial de Transacciones</h3>
      </div>
      <div class="card-body">

        <!-- Empty State -->
        <div *ngIf="transactions.length === 0" class="empty-state">
          <p>No hay transacciones para esta cuenta</p>
        </div>

        <!-- Transactions Table -->
        <div *ngIf="transactions.length > 0" class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Tipo</th>
                <th>Descripción</th>
                <th>Moneda</th>
                <th class="text-right">Monto Total</th>
                <th class="text-right">Fee</th>
                <th class="text-right">Monto Real</th>
                <th *ngIf="hasCompraDivisaTransactions()" style="min-width: 150px;">Tasa de Cambio</th>
                <th *ngIf="hasCableTransactions()">Banco/Wallet</th>
                <th *ngIf="hasCableTransactions()">Titular/Originante</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let transaction of transactions">
                <td style="font-family: monospace; font-size: var(--font-xs);">{{ formatDate(transaction.createdAt) }}</td>
                <td>
                  <span class="transaction-type" [class]="getTransactionTypeClass(transaction.type)">
                    {{ getTransactionSignAndType(transaction).type }}
                  </span>
                </td>
                <td>{{ getTransactionDescription(transaction) }}</td>
                <td>{{ transaction.currency }}</td>
                <td class="text-right">
                  <!-- Monto Total (siempre se muestra) -->
                  <span class="amount" [class]="getTransactionTypeClass(transaction.type)">
                    <ng-container *ngIf="transaction.feeApplied && transaction.originalAmount">
                      {{ getTransactionSignAndType(transaction).sign }}{{ formatCurrencyLatin(transaction.originalAmount!) }}
                    </ng-container>
                    <ng-container *ngIf="!transaction.feeApplied || !transaction.originalAmount">
                      {{ getTransactionSignAndType(transaction).sign }}{{ formatCurrencyLatin(transaction.amount) }}
                    </ng-container>
                  </span>
                </td>
                <td class="text-right">
                  <!-- Fee (solo si se aplicó fee) -->
                  <span *ngIf="transaction.feeApplied && transaction.feeValue" class="fee-amount-display">
                    {{ transaction.feeType === 'percentage' ? transaction.feeValue + '%' : '$' + transaction.feeValue }}
                    (-{{ formatCurrencyLatin(calculateFeeAmountFromTransaction(transaction)) }})
                  </span>
                  <span *ngIf="!transaction.feeApplied" class="no-fee">
                    Sin fee
                  </span>
                </td>
                <td class="text-right">
                  <!-- Monto Real (siempre se muestra) -->
                  <span class="amount final-amount-display" [class]="getTransactionTypeClass(transaction.type)">
                    {{ getTransactionSignAndType(transaction).sign }}{{ formatCurrencyLatin(transaction.amount) }}
                  </span>
                </td>
                <td *ngIf="hasCompraDivisaTransactions()" style="min-width: 150px; white-space: nowrap;">
                  <span *ngIf="transaction.type === 'Compra Divisa' && transaction.exchangeRate" class="exchange-rate-display">
                    {{ formatExchangeRate(transaction) }}
                  </span>
                  <span *ngIf="transaction.type !== 'Compra Divisa' || !transaction.exchangeRate" class="text-muted">
                    —
                  </span>
                </td>
                <td *ngIf="hasCableTransactions()">
                  <span *ngIf="transaction.currency === 'CABLE' && transaction.bancoWallet" class="cable-detail">
                    {{ transaction.bancoWallet }}
                  </span>
                  <span *ngIf="transaction.currency !== 'CABLE' || !transaction.bancoWallet" class="text-muted">
                    —
                  </span>
                </td>
                <td *ngIf="hasCableTransactions()">
                  <span *ngIf="transaction.currency === 'CABLE' && transaction.titularOriginante" class="cable-detail">
                    {{ transaction.titularOriginante }}
                  </span>
                  <span *ngIf="transaction.currency !== 'CABLE' || !transaction.titularOriginante" class="text-muted">
                    —
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>

  </div>

</div>

<!-- Swap Modal -->
<div *ngIf="showSwapModal" class="modal-overlay" (click)="closeSwapModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-exchange-alt"></i> Compra Divisa {{ selectedCurrency }}</h3>
      <button class="modal-close" (click)="closeSwapModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="createCompraDivisa()" #swapFormElement="ngForm">

        <!-- Amount -->
        <div class="form-group">
          <label class="form-label">Monto a intercambiar *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="swapForm.amountDisplay"
            name="swapAmount"
            (input)="onAmountInput(swapForm, 'amount')"
            (blur)="onAmountBlur(swapForm, 'amount')"
            required
            placeholder="0,00">
        </div>

        <!-- Target Currency -->
        <div class="form-group">
          <label class="form-label">Moneda destino *</label>
          <select
            class="form-control"
            [(ngModel)]="swapForm.targetCurrency"
            name="targetCurrency"
            (change)="onTargetCurrencyChange()"
            required>
            <option *ngFor="let currency of mainCurrencies" [value]="currency" [disabled]="currency === selectedCurrency">
              {{ currency }}
            </option>
          </select>
        </div>

        <!-- Exchange Rate -->
        <div class="form-group">
          <label class="form-label">Tasa de cambio *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="swapForm.exchangeRateDisplay"
            name="exchangeRate"
            (input)="onAmountInput(swapForm, 'exchangeRate')"
            (blur)="onAmountBlur(swapForm, 'exchangeRate')"
            required
            placeholder="1,00">
          <small class="form-text text-muted" style="margin-top: var(--space-1); display: block;">
            <ng-container *ngIf="selectedCurrency === 'CHEQUE' && swapForm.targetCurrency === 'PESOS'">
              Conversión especial: 1 PESO = {{ swapForm.exchangeRate | number:'1.0-2' }} CHEQUE
            </ng-container>
            <ng-container *ngIf="!(selectedCurrency === 'CHEQUE' && swapForm.targetCurrency === 'PESOS')">
              Tasa estándar: 1 {{ selectedCurrency }} = {{ swapForm.exchangeRate | number:'1.0-4' }} {{ swapForm.targetCurrency }}
            </ng-container>
            <button type="button" class="btn btn-sm" (click)="onTargetCurrencyChange()" style="margin-left: var(--space-2); padding: 0.125rem 0.5rem;">
              <i class="fas fa-sync-alt"></i> Calcular tasa automática
            </button>
          </small>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label class="form-label">Descripción *</label>
          <select [(ngModel)]="swapForm.descriptionType" name="swapDescriptionType" 
                  class="form-control" (change)="onDescriptionTypeChange(swapForm)">
            <option *ngFor="let desc of getPredefinedDescriptionsForCurrency(selectedCurrency)" [value]="desc">{{ desc }}</option>
          </select>
          <input *ngIf="isCustomDescription(swapForm)" 
                 type="text" [(ngModel)]="swapForm.customDescription" 
                 name="swapCustomDescription" class="form-control" 
                 placeholder="Ingrese descripción personalizada" required>
        </div>

        <!-- CABLE specific fields -->
        <div *ngIf="selectedCurrency === 'CABLE'" class="form-group">
          <label class="form-label">Banco/Wallet *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="swapForm.bancoWallet"
            name="swapBancoWallet"
            required
            placeholder="Ej: Binance, Coinbase, Banco X">
        </div>

        <div *ngIf="selectedCurrency === 'CABLE'" class="form-group">
          <label class="form-label">Titular/Originante *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="swapForm.titularOriginante"
            name="swapTitularOriginante"
            required
            placeholder="Nombre del titular o originante">
        </div>

        <!-- Summary -->
        <div class="transaction-summary" *ngIf="swapForm.amount && swapForm.amount > 0 && swapForm.exchangeRate > 0">
          <div class="summary-item">
            <span class="summary-label">Monto a intercambiar:</span>
            <span class="summary-value">{{ formatCurrencyLatin(swapForm.amount) }} {{ selectedCurrency }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Monto recibido (calculado):</span>
            <span class="summary-value" style="font-weight: 700; color: var(--color-success);">
              <ng-container *ngIf="selectedCurrency === 'CHEQUE' && swapForm.targetCurrency === 'PESOS'">
                {{ formatCurrencyLatin(swapForm.amount / swapForm.exchangeRate) }} {{ swapForm.targetCurrency }}
              </ng-container>
              <ng-container *ngIf="!(selectedCurrency === 'CHEQUE' && swapForm.targetCurrency === 'PESOS')">
              {{ formatCurrencyLatin(swapForm.amount * swapForm.exchangeRate) }} {{ swapForm.targetCurrency }}
              </ng-container>
            </span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Tasa aplicada:</span>
            <span class="summary-value">
              <ng-container *ngIf="selectedCurrency === 'CHEQUE' && swapForm.targetCurrency === 'PESOS'">
                Conversión especial: 1 PESO = {{ swapForm.exchangeRate | number:'1.0-2' }} CHEQUE
              </ng-container>
              <ng-container *ngIf="!(selectedCurrency === 'CHEQUE' && swapForm.targetCurrency === 'PESOS')">
                1 {{ selectedCurrency }} = {{ swapForm.exchangeRate | number:'1.0-4' }} {{ swapForm.targetCurrency }}
              </ng-container>
            </span>
          </div>
        </div>

      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeSwapModal()">
        Cancelar
      </button>
      <button
        type="button"
        class="btn btn-warning"
        [disabled]="!swapForm.amount || swapForm.amount <= 0 || !getDescription(swapForm).trim() || !swapForm.targetCurrency || swapForm.targetCurrency === selectedCurrency || creatingTransaction"
        (click)="createCompraDivisa()">
        <span *ngIf="creatingTransaction" class="loading"></span>
        {{ creatingTransaction ? 'Creando...' : 'Ejecutar Intercambio' }}
      </button>
    </div>
  </div>
</div>

<!-- Transfer Modal -->
<div *ngIf="showTransferModal" class="modal-overlay" (click)="closeTransferModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-arrow-right"></i> {{ selectedCurrency }}</h3>
      <button class="modal-close" (click)="closeTransferModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="createTransfer()" #transferFormElement="ngForm">

        <!-- Amount -->
        <div class="form-group">
          <label class="form-label">Monto a transferir *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="transferForm.amountDisplay"
            name="transferAmount"
            (input)="onAmountInput(transferForm, 'amount')"
            (blur)="onAmountBlur(transferForm, 'amount')"
            required
            placeholder="0,00">
        </div>

        <!-- Target Account -->
        <div class="form-group">
          <label class="form-label">Cuenta destino *</label>
          <select
            class="form-control"
            [(ngModel)]="transferForm.targetAccountId"
            name="targetAccountId"
            required
            (change)="onTargetAccountChange()">
            <option value="">Seleccionar cuenta destino</option>
            <option *ngFor="let account of getAvailableTargetAccounts()" [value]="account._id">
              {{ account.name }}
            </option>
          </select>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label class="form-label">Descripción *</label>
          <select [(ngModel)]="transferForm.descriptionType" name="transferDescriptionType" 
                  class="form-control" (change)="onDescriptionTypeChange(transferForm)">
            <option *ngFor="let desc of getPredefinedDescriptionsForCurrency(selectedCurrency)" [value]="desc">{{ desc }}</option>
          </select>
          <input *ngIf="isCustomDescription(transferForm)" 
                 type="text" [(ngModel)]="transferForm.customDescription" 
                 name="transferCustomDescription" class="form-control" 
                 placeholder="Ingrese descripción personalizada" required>
        </div>

        <!-- CABLE specific fields -->
        <div *ngIf="selectedCurrency === 'CABLE'" class="form-group">
          <label class="form-label">Banco/Wallet *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="transferForm.bancoWallet"
            name="transferBancoWallet"
            required
            placeholder="Ej: Binance, Coinbase, Banco X">
        </div>

        <div *ngIf="selectedCurrency === 'CABLE'" class="form-group">
          <label class="form-label">Titular/Originante *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="transferForm.titularOriginante"
            name="transferTitularOriginante"
            required
            placeholder="Nombre del titular o originante">
        </div>

        <!-- Summary -->
        <div class="transaction-summary" *ngIf="transferForm.amount && transferForm.amount > 0 && transferForm.targetAccount">
          <div class="summary-item">
            <span class="summary-label">Monto a transferir:</span>
            <span class="summary-value">{{ formatCurrency(transferForm.amount) }} {{ selectedCurrency }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Cuenta destino:</span>
            <span class="summary-value">{{ transferForm.targetAccount.name }}</span>
          </div>
        </div>

      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeTransferModal()">
        Cancelar
      </button>
      <button
        type="button"
        class="btn btn-info"
        [disabled]="!transferForm.amount || transferForm.amount <= 0 || !getDescription(transferForm).trim() || !transferForm.targetAccountId || transferForm.targetAccountId === accountId || creatingTransaction"
        (click)="createTransfer()">
        <span *ngIf="creatingTransaction" class="loading"></span>
        {{ creatingTransaction ? 'Creando...' : 'Ejecutar Transferencia' }}
      </button>
    </div>
  </div>
</div>

<!-- Transaction Modal -->
<div *ngIf="showTransactionModal" class="modal-overlay" (click)="closeTransactionModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i [class]="transactionType === 'Entrada' ? 'fas fa-plus' : 'fas fa-minus'"></i>
        {{ transactionType === 'Entrada' ? 'Nuevo Ingreso' : 'Nuevo Egreso' }} - {{ selectedCurrency }}
      </h3>
      <button class="modal-close" (click)="closeTransactionModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="createTransaction()" #transactionFormElement="ngForm">

        <!-- Amount -->
        <div class="form-group">
          <label class="form-label">Monto *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="transactionForm.amountDisplay"
            name="amount"
            (input)="onAmountInput(transactionForm, 'amount')"
            (blur)="onAmountBlur(transactionForm, 'amount')"
            required
            placeholder="0,00"
            #amountInput="ngModel">
          <div *ngIf="amountInput.invalid && amountInput.touched" class="form-error">
            El monto es requerido y debe ser mayor a cero
          </div>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label class="form-label">Descripción *</label>
          <select [(ngModel)]="transactionForm.descriptionType" name="descriptionType" 
                  class="form-control" (change)="onDescriptionTypeChange(transactionForm)">
            <option *ngFor="let desc of getPredefinedDescriptionsForCurrency(selectedCurrency)" [value]="desc">{{ desc }}</option>
          </select>
          <input *ngIf="isCustomDescription(transactionForm)" 
                 type="text" [(ngModel)]="transactionForm.customDescription" 
                 name="customDescription" class="form-control" 
                 placeholder="Ingrese descripción personalizada" required>
        </div>

        <!-- CABLE specific fields -->
        <div *ngIf="selectedCurrency === 'CABLE'" class="form-group">
          <label class="form-label">Banco/Wallet *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="transactionForm.bancoWallet"
            name="bancoWallet"
            required
            placeholder="Ej: Binance, Coinbase, Banco X">
          </div>

        <div *ngIf="selectedCurrency === 'CABLE'" class="form-group">
          <label class="form-label">Titular/Originante *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="transactionForm.titularOriginante"
            name="titularOriginante"
            required
            placeholder="Nombre del titular o originante">
        </div>

        <!-- Fee Configuration -->
        <div class="fee-section">
          <div class="fee-toggle">
            <label class="toggle-label">
              <input
                type="checkbox"
                [(ngModel)]="transactionForm.applyFee"
                name="applyFee"
                class="toggle-input">
              <span class="toggle-slider"></span>
              <span class="toggle-text">Aplicar Fee</span>
            </label>
          </div>

          <!-- Fee Details -->
          <div *ngIf="transactionForm.applyFee" class="fee-details-card">
            <div class="fee-inputs-grid">
              <div class="fee-input-group">
                <label class="fee-input-label">Tipo de Fee</label>
                <div class="fee-select-wrapper">
                  <select
                    class="fee-select"
                    [(ngModel)]="transactionForm.feeType"
                    name="feeType">
                    <option value="percentage">Porcentaje (%)</option>
                    <option value="fixed">Monto Fijo</option>
                  </select>
                  <i class="fas fa-chevron-down select-icon"></i>
                </div>
              </div>

              <div class="fee-input-group">
                <label class="fee-input-label">
                  Valor del Fee
                  <span class="fee-unit">{{ transactionForm.feeType === 'percentage' ? '(%)' : '(' + selectedCurrency + ')' }}</span>
                </label>
                <div class="fee-input-wrapper">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    [max]="transactionForm.feeType === 'percentage' ? '100' : null"
                    class="fee-input"
                    [(ngModel)]="transactionForm.feeValue"
                    name="feeValue"
                    placeholder="0.00">
                  <span class="fee-currency-indicator" *ngIf="transactionForm.feeType === 'percentage'">%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Summary -->
        <div class="transaction-summary" *ngIf="transactionForm.amount && transactionForm.amount > 0">
          <div class="summary-item">
            <span class="summary-label">Tipo:</span>
            <span class="summary-value">{{ transactionType }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Moneda:</span>
            <span class="summary-value">{{ selectedCurrency }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Monto Ingresado:</span>
            <span class="summary-value">{{ formatCurrency(transactionForm.amount) }}</span>
          </div>
          <div class="summary-item" *ngIf="transactionForm.applyFee && transactionForm.feeValue && transactionForm.feeValue > 0">
            <span class="summary-label">
              Fee {{ transactionForm.feeType === 'percentage' ? '(' + transactionForm.feeValue + '%)' : '(fijo)' }}:
            </span>
            <span class="summary-value fee-amount">
              -{{ formatCurrency(calculateFeeAmount(transactionForm.amount)) }}
            </span>
          </div>
          <div class="summary-item total-item" *ngIf="transactionForm.applyFee && transactionForm.feeValue && transactionForm.feeValue > 0">
            <span class="summary-label total-label">Monto Final:</span>
            <span class="summary-value total-value">{{ formatCurrency(calculateFinalAmount(transactionForm.amount, selectedCurrency!, transactionType!)) }}</span>
          </div>
        </div>

      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeTransactionModal()">
        Cancelar
      </button>
      <button
        type="button"
        class="btn"
        [class]="transactionType === 'Entrada' ? 'btn-success' : 'btn-error'"
        [disabled]="!transactionForm.amount || transactionForm.amount <= 0 || !getDescription(transactionForm).trim() || (transactionForm.applyFee && (!transactionForm.feeValue || transactionForm.feeValue <= 0)) || creatingTransaction"
        (click)="createTransaction()">
        <span *ngIf="creatingTransaction" class="loading"></span>
        {{ creatingTransaction ? 'Creando...' : (transactionType === 'Entrada' ? 'Crear Ingreso' : 'Crear Egreso') }}
      </button>
    </div>
  </div>
</div>
