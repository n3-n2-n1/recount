<!-- Simple Accounts Page -->
<div page-content>

  <!-- Alerts -->
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

  <!-- Stats -->
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4); margin-bottom: var(--space-4);">
    <div class="card">
      <div class="card-body">
        <div class="flex-between">
          <span>Total de cuentas</span>
          <strong>{{ accounts.length }}</strong>
  </div>
</div>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="flex-between">
          <span>Balances activos</span>
          <strong>{{ getActiveBalancesCount() }}</strong>
    </div>
  </div>
</div>
  </div>

  <!-- Accounts Table -->
  <div class="card">
    <div class="card-header">
      <div class="flex-between">
        <h3>Cuentas</h3>
        <div style="display: flex; gap: var(--space-2); align-items: center;">
          <input type="text" placeholder="Buscar cuentas..." class="form-control" 
                 style="width: 200px;" [(ngModel)]="searchTerm" (input)="onSearchChange()">
          <button class="btn btn-primary" (click)="onAddUser()">Agregar cuenta</button>
      </div>
      </div>
    </div>
    <div class="card-body">
      <div *ngIf="loading" class="text-center">
        <span class="loading"></span> Cargando cuentas...
      </div>

      <div *ngIf="!loading && filteredAccounts.length === 0 && searchTerm" class="text-center text-muted">
        No se encontraron cuentas que coincidan con tu búsqueda.
        <button class="btn btn-sm" (click)="clearSearch()" style="margin-left: var(--space-2);">Limpiar</button>
</div>

      <div *ngIf="!loading && accounts.length === 0 && !searchTerm" class="text-center text-muted">
        No se han creado cuentas aún.
  </div>

      <div *ngIf="!loading && filteredAccounts.length > 0">
  <app-editable-table
    [data]="filteredAccounts"
    [columns]="columns"
    [loading]="loading"
    [canEdit]="true"
    [canDelete]="true"
    [canAdd]="false"
    (edit)="onEditUser($event)"
    (delete)="onDeleteUser($event)"
    (cellClick)="$event.column === 'name' ? viewAccountDetail($event.item._id) : null">
  </app-editable-table>
      </div>
    </div>
</div>

</div>

<!-- Modal para agregar cuenta -->
<div *ngIf="showAddModal" class="modal-overlay" (click)="closeAddModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Agregar Nueva Cuenta</h3>
      <button class="btn-close" (click)="closeAddModal()" [disabled]="creatingAccount">&times;</button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label for="accountName">Nombre de la cuenta *</label>
        <input
          type="text"
          id="accountName"
          class="form-control"
          [(ngModel)]="newAccountName"
          placeholder="Ej: Cuenta Personal, Banco XYZ..."
          [disabled]="creatingAccount"
          (keyup.enter)="isAddFormValid() && createAccount()"
          autofocus>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn" (click)="closeAddModal()" [disabled]="creatingAccount">
        Cancelar
      </button>
      <button 
        class="btn btn-primary" 
        (click)="createAccount()" 
        [disabled]="!isAddFormValid() || creatingAccount">
        <span *ngIf="creatingAccount" class="loading"></span>
        {{ creatingAccount ? 'Creando...' : 'Crear Cuenta' }}
      </button>
    </div>
  </div>
</div>